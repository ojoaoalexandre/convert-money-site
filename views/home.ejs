<%- include('./template/header'); %>

<h1>Convers√£o</h1>
<form class="form-convert" method="GET" action="/">

  <input type="text" name="fromCoinValue" id="fromCoinValue" value="<%= fromCoinValue %>" />

  <select id="fromCoinCode" name="fromCoinCode">
    <% selectCoin.forEach(coin => { %>
    <option value="<%= coin.code %>" <%- coin.code == fromCoinCode ? "selected" : ""  %>><%= coin.name %></option>
    <% }) %>
  </select>

  <input id="quotation" type="text" name="toCoinValue" value="<%= quotation.ask %>" />

  <select id="toCoinCode" name="toCoinCode"></select>

  <button type="submit">Converter</button>
</form>

<script>
  const filterToCoinCode = document.getElementById('toCoinCode')

  const createNode = (element) => {
    return document.createElement(element)
  }

  const append = (parent, element) => {
    return parent.appendChild(element)
  }

  const updateFilter = async (code) => {
      while (filterToCoinCode.firstChild) {
        filterToCoinCode.removeChild(filterToCoinCode.firstChild)
      }

      await fetch(`/filter?filtertoCoinCode=${code}`)
        .then(response => response.json())
        .then((data) => {
          return data.map(item => {
            let option = createNode('option')
            option.value = item.code
            option.innerHTML = `${item.name}`
            append(filterToCoinCode, option)
          })
        })
  }

  document.addEventListener('DOMContentLoaded', () => {
    const filterMain = document.getElementById('fromCoinCode')
    
    // first load
    updateFilter(filterMain.value)

    // load dinamic
    filterMain.addEventListener('change', (e) => {
      updateFilter(e.target.value)
    })
  })
</script>

<%- include('./template/footer') %>
